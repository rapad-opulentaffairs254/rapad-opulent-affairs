<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard - Rapad Opulent Affairs</title>
  <link rel="stylesheet" href="style.css" />
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc, collection, getDocs, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCCZ5h5moCnPdVq6zXQYHhx7FcUsZHnhgk",
      authDomain: "rapad-employee-portal.firebaseapp.com",
      projectId: "rapad-employee-portal",
      storageBucket: "rapad-employee-portal.appspot.com",
      messagingSenderId: "276746044900",
      appId: "1:276746044900:web:4cf1ab62c98ba85d5c33f1",
      measurementId: "G-L54YK0VXC8"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "employee-portal.html";
        return;
      }

      const docRef = doc(db, "users", user.uid);
      const docSnap = await getDoc(docRef);

      if (!docSnap.exists() || docSnap.data().role !== "admin") {
        alert("Access denied. Admins only.");
        window.location.href = "employee-portal.html";
        return;
      }

      // Load employees
      const employeesSnapshot = await getDocs(collection(db, "users"));
      const employeesList = document.getElementById("employeesList");
      employeesList.innerHTML = "";

      employeesSnapshot.forEach((doc) => {
        const data = doc.data();
        const empDiv = document.createElement("div");
        empDiv.innerHTML = `
          <p><strong>${data.name}</strong> (${data.position}) - ${data.email} <br/>
          Status: ${data.approved ? "✅ Approved" : "❌ Not Approved"}
          ${!data.approved ? `<button data-id="${doc.id}" class="approve-btn">Approve</button>` : ""}</p>
          <hr>
        `;
        employeesList.appendChild(empDiv);
      });

      document.querySelectorAll(".approve-btn").forEach((btn) => {
        btn.addEventListener("click", async (e) => {
          const id = e.target.getAttribute("data-id");
          await updateDoc(doc(db, "users", id), { approved: true });
          alert("User approved!");
          location.reload();
        });
      });
    });

    document.getElementById("logoutBtn").addEventListener("click", async () => {
      await signOut(auth);
      window.location.href = "employee-portal.html";
    });
  </script>
</head>
<body>
  <header class="portal-header">
    <h1>Admin Dashboard</h1>
    <button id="logoutBtn" class="gold-button" style="float:right; margin-right: 20px;">Logout</button>
  </header>

  <main class="portal-container">
    <nav class="tabs-nav">
      <button class="tab-btn active" data-tab="manageEmployeesTab">Manage Employees</button>
      <button class="tab-btn" data-tab="assignSchedulesTab">Assign Schedules</button>
      <button class="tab-btn" data-tab="leaveManagementTab">Leaves & Offs</button>
      <button class="tab-btn" data-tab="assignDutiesTab">Assign Duties</button>
    </nav>

    <section id="manageEmployeesTab" class="tab-content active">
      <h2>Manage Employees</h2>
      <div id="employeesList">Loading employees...</div>
        <h3>Pending Approvals</h3>
        <ul id="approvalList"></ul>
    </section>

    <section id="assignSchedulesTab" class="tab-content">
      <h2>Assign Schedules</h2>
      <form id="scheduleForm">
        <label for="employeeSelectSchedule">Select Employee</label>
        <select id="employeeSelectSchedule" required></select>

        <label for="scheduleDetails">Schedule Details</label>
        <textarea id="scheduleDetails" rows="4" required></textarea>

        <button type="submit" class="gold-button">Assign Schedule</button>
      </form>
      <div id="scheduleMsg"></div>
    </section>

    <section id="leaveManagementTab" class="tab-content">
      <h2>Manage Leaves & Offs</h2>
      <form id="leaveForm">
        <label for="employeeSelectLeave">Select Employee</label>
        <select id="employeeSelectLeave" required></select>

        <label for="leaveDetails">Leave/Off Details</label>
        <textarea id="leaveDetails" rows="4" required></textarea>

        <button type="submit" class="gold-button">Submit Leave/Off</button>
      </form>
      <div id="leaveMsg"></div>
    </section>

    <section id="assignDutiesTab" class="tab-content">
      <h2>Assign Duties</h2>
      <form id="dutyForm">
        <label for="employeeSelectDuty">Select Employee</label>
        <select id="employeeSelectDuty" required></select>

        <label for="dutyDetails">Duty Details</label>
        <textarea id="dutyDetails" rows="4" required></textarea>

        <button type="submit" class="gold-button">Assign Duty</button>
      </form>
      <div id="dutyMsg"></div>
    </section>
  </main>
  <script>
  // Tab functionality
  const tabButtons = document.querySelectorAll(".tab-btn");
  const tabContents = document.querySelectorAll(".tab-content");

  tabButtons.forEach(button => {
    button.addEventListener("click", () => {
      const targetTab = button.getAttribute("data-tab");

      // Remove active class from all buttons and contents
      tabButtons.forEach(btn => btn.classList.remove("active"));
      tabContents.forEach(tab => tab.classList.remove("active"));

      // Add active class to clicked button and corresponding content
      button.classList.add("active");
      document.getElementById(targetTab).classList.add("active");
    });
  });
</script>

</body>
</html>
